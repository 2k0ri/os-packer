#!/bin/bash

set -e -x

VERSION=beta

DEVICE=/dev/xvda

if [ "$PACKER_BUILDER_TYPE" == "virtualbox-iso" ]; then
    export DEVICE=/dev/sda
    sudo system-docker run -it --privileged cloudnautique/installer:${VERSION} /scripts/set-disk-partitions ${DEVICE}
    sudo system-docker start udev
fi

sudo system-docker run -it --privileged cloudnautique/installer:${VERSION} /scripts/lay-down-os ${DEVICE} $PACKER_BUILDER_TYPE
